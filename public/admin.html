<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin panel</title>
  <style>
    body {
      font-family: system-ui;
      background: #020617;
      color: #e5e7eb;
      padding: 20px;
    }

    .card {
      border: 1px solid #1e293b;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    img {
      width: 64px;
      height: 64px;
      background: #020617;
      border-radius: 10px;
    }

    textarea {
      width: 100%;
      height: 60px;
      margin-top: 6px;
    }

    button {
      margin-top: 6px;
      margin-right: 6px;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .ok { background: #16a34a; color: white; }
    .mid { background: #ca8a04; color: white; }
    .no { background: #dc2626; color: white; }
  </style>
</head>
<body>
  <h2>Admin moderation</h2>

  <p>
    ⚠️ you may see disturbing or nsfw uploads.  
    if you are not feeling well today, don’t moderate.
  </p>

  <div id="list"></div>

  <script>
    fetch("/api/emojis?pending=true")
      .then(r => r.json())
      .then(data => {
        const list = document.getElementById("list");

        data.forEach(e => {
          const div = document.createElement("div");
          div.className = "card";

          div.innerHTML = `
            <img src="/uploads/${e.file}">
            <div style="flex:1">
              <b>${e.unicode}</b><br>
              author: ${e.author}
              <textarea placeholder="admin note"></textarea><br>
              <button class="ok">approve</button>
              <button class="mid">almost</button>
              <button class="no">reject</button>
            </div>
          `;

          const textarea = div.querySelector("textarea");

          div.querySelector(".ok").onclick = () =>
            send(e.id, "approved");

          div.querySelector(".mid").onclick = () =>
            send(e.id, "almost", textarea.value);

          div.querySelector(".no").onclick = () =>
            send(e.id, "rejected", textarea.value);

          list.appendChild(div);
        });
      });

    function send(id, status, note) {
      fetch("/api/moderate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, status, note })
      }).then(() => location.reload());
    }
  </script>
</body>
</html>
